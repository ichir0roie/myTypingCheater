!function(){var l="myTypingComment";window[l]={showLastCommentList:function(){var e=new Date;$.ajax({type:"POST",url:"/get-comment-list-json",data:{modelId:$("#modelId").val(),dataId:$("#dataId").val(),pw:$("#commentForm-pw").val(),t:e.getTime()},dataType:"json"}).done(function(e){"OK"==e.status?($("#commentListArea").html(e.html),window[l].setCommentReplyLink($("#comments"))):$("#commentListArea").html('<span class="error">コメントが見つかりません。</span>')}).fail(function(){$("#commentListArea").html('<span class="error">コメントの取得に失敗しました。</span>')})},readyComment:function(){$("#commentForm .isNeedLoginComment #commentDescription").focusin(function(){showPopup("この"+$("#commentModelIdString").val()+"にコメントするにはログインが必要です。",{tag:"a",href:"/login.html",html:"ログイン／ユーザー登録(無料)"},{tag:"span",html:"キャンセル",class:"popupBoxClose"})}),$("#commentForm #commentButton").click(function(){var o=new Date,e=$("#comments .comment:last-child .commentNo").html(),n=$("#commentForm-redirectUrl").val(),t=$("#commentForm-pw").val(),m=0;n&&(m=1),$.ajax({type:"POST",url:"/comment-json",data:{modelId:$("#modelId").val(),dataId:$("#dataId").val(),description:$("#commentDescription").val(),isReload:m,lastCommentNo:e,pw:t,t:o.getTime()},dataType:"json"}).done(function(e){if("OK"==e.status)if($("#commentDescription").val(""),e.message)showAlert(e.message);else if(n){var t="?";n.match(/\?/)&&(t="&"),location.href=n+t+"t="+o.getTime()+"#commentNo"+e.postedCommentNo}else e.addHtml&&($("#commentListArea").length||$("#commentForm").before('<div id="commentListArea"><div id="commentList"><h2 id="commentTitle" class="h2Yellow markComment">みんなのコメント</h2><div id="comments"></div></div></div>'),$("#comments").append(e.addHtml),$("#commentTitle").show(),$("#comments").show(),window[l].setCommentReplyLink($("#comments")));else e.message?(showAlert(e.message),0<=e.message.indexOf("投稿はチェック後に反映されます。")&&$("#commentDescription").val("")):showAlert("コメントの投稿に失敗しました・・・")}).fail(function(){showAlert("コメントの投稿に失敗しました")})}),$(".comment .commentControlReply").live("click",function(){var e=$("#commentForm").offset().top;return $("#commentForm #commentDescription").val("※"+$(this).closest(".comment").find(".commentNo").html()+"\n"+$("#commentForm #commentDescription").val()),$("body,html").animate({scrollTop:e},500,"swing"),!1}),$(".comment .commentControlDelete").live("click",function(){var e=new Date,t=$(this).closest(".comment"),m=$("#modelId").val(),s=$("#dataId").val(),a=t.find(".commentNo").html();showConfirm("本当に削除しますか？",function(){$.ajax({type:"POST",url:"/comment-delete-json",data:{modelId:m,dataId:s,commentNo:a,t:e.getTime()},dataType:"json"}).done(function(e){"OK"==e.status?(t.remove(),1==e.deleterType||2==e.deleterType?setTimeout(function(){showConfirm("削除しました。\n投稿者とそのドメインをブラックリストに登録しますか？",function(){var e,t,o,n;e=m,t=s,o=a,n=new Date,$.ajax({type:"POST",url:"/user/add-black-list-from-comment-json",data:{modelId:e,dataId:t,commentNo:o,t:n.getTime()},dataType:"json"}).done(function(e){"OK"==e.status?showAlert("ブラックリストに登録しました。"):e.message?showAlert(e.message):showAlert("ブラックリストの登録に失敗しました・・・")}).fail(function(){showAlert("ブラックリストの登録に失敗しました")})})},0):showAlert("削除しました。")):e.message?showAlert(e.message):showAlert("コメントの削除に失敗しました・・・")}).fail(function(){showAlert("コメントの削除に失敗しました")})})}),$("#commentList .comment").live({mouseenter:function(){$(this).find(".commentControl").css("visibility","visible")},mouseleave:function(){matchMedia("(hover: none)").matches||$(this).find(".commentControl").css("visibility","hidden")}}),$("#commentList .commentReplyNo").live({click:function(){var e=Number($(this).html().replace(/※/g,"").replace(/[０-９]/g,function(e){return String.fromCharCode(e.charCodeAt(0)-65248)}));window[l].showCommentReply(e,$(this))}}),window[l].setCommentReplyLink($("#comments"))},setCommentReplyLink:function(e){e.find(".commentDescription").each(function(e,t){$(t).children(".commentReply").length||$(t).html($(t).html().replace(/※[0-9０-９]+/g,'<span class="commentReply"><span class="commentReplyNo">$&</span></span>'))})},showCommentReply:function(e,t){var o=t.parent().children(".replyBox");if(o.length)"block"==o.css("display")?o.hide():o.show();else{t.parent().append('<div class="replyBox"></div>'),o=t.parent().children(".replyBox");if(10<t.parents(".commentReply").length)return o.html('<span class="error">これ以上取得できません。</span>'),void o.show();if($("#commentNo"+e).length)o.append('<div class="commentInfo">'+$("#commentNo"+e+" .commentInfo").html()+"</div>"),o.append('<div class="commentDescription">'+$("#commentNo"+e+" .commentDescription").html()+"</div>"),o.find(".commentDescription .replyBox").remove(),o.show();else{o.html("コメント取得中"),o.show();var n=$("#modelId").val(),m=$("#dataId").val(),s=$("#commentForm-pw").val(),a=new Date,i=1;onGetCommentTimer=setInterval(function(){0<i&&i<=10&&o.append("…"),i++},1e3),$.ajax({type:"POST",url:"/get-comment-json",data:{modelId:n,dataId:m,commentNo:e,pw:s,t:a.getTime()},dataType:"json"}).done(function(e){i=0,clearInterval(onGetCommentTimer),"OK"==e.status?(o.html(e.html),window[l].setCommentReplyLink(o)):o.html('<span class="error">コメントが見つかりません。</span>')}).fail(function(){i=0,clearInterval(onGetCommentTimer),o.html('<span class="error">コメントの取得に失敗しました。</span>')})}}}}}(),$(function(){window.myTypingComment.readyComment()});!function(){var a,o,l,c,h,d,w,m="myTypingTwitter";window[m]={initTimeline:function(t,e,n,s){l=e,h=1,d=void 0,w=0,o=(a=t).replace(/(https?:\/\/|\/$)/g,""),null==s&&(s=!0);var i=new Date;c=Math.floor(i.getTime()/36e5);var r="";r+='<h2 class="h2Yellow tweetTitle"><a href="https://twitter.com/search?q='+encodeURIComponent(o+"/game/"+l)+'" rel="nofollow" target="_blank">関連ツイート</a></h2>',r+='<div class="tweetsArea">',r+='\t<div class="tweets"></div>',r+='\t<div class="moreTweet">',s?r+='\t\t<a href="https://twitter.com/search?q='+encodeURIComponent(o+"/game/"+l)+'" rel="nofollow" target="_blank"><div class="moreTweetButton">さらにツイートを見る</div></a>':(r+='\t\t<div class="moreTweetButton" onClick="javascript:'+m+'.setTimeline();">さらに読み込む</div>',r+='\t\t<div class="noMoreTweet" style="display:none;">これ以上ツイートはありません。</div>'),r+="\t</div>",r+="</div>",r+='<div class="newTweet"><a href="https://twitter.com/intent/tweet?url='+encodeURIComponent(a+"game/"+l)+"&hashtags="+encodeURIComponent(n)+'" rel="nofollow" target="_blank">ツイートする</a></div>',$("#twitterTimeLine").html(r),$("#twitterTimeLine .tweet").live({mouseenter:function(){$(this).find(".tweetControl").css("visibility","visible")},mouseleave:function(){isSp()||$(this).find(".tweetControl").css("visibility","hidden")}})},setTimeline:function(){void 0!==d&&d<h&&($("#twitterTimeLine .moreTweetButton").hide(),$("#twitterTimeLine .noMoreTweet").show()),$.getJSON("/game-tweet-json?gameId="+l+"&page="+h+"&countPerPage=20&t="+c,function(t){if("OK"==t.status){var e='<div id="tweets'+h+'" style="display:none;">';$.each(t.data,function(){e+='<div class="tweet" id="tweet'+this.tweetId+'>">',e+='\t<div class="image"><a href="https://twitter.com/'+this.screenName+'" rel="nofollow" target="_blank"><img src="'+this.imageUrl+'" /></a></div>',e+='\t<div class="tweetInfo">',e+='\t\t<div class="tweetInfoTop">',e+='\t\t\t<a class="userName" href="https://twitter.com/'+this.screenName+'" rel="nofollow" target="_blank">'+this.userName+'</a>&nbsp;<a class="screenName" href="https://twitter.com/'+this.screenName+'" rel="nofollow" target="_blank">@'+this.screenName+"</a>",e+='\t\t\t<div class="right"><a class="time" href="https://twitter.com/'+this.screenName+"/status/"+this.tweetId+'" rel="nofollow" target="_blank">'+window[m].showTweetTime(this.createdTime)+"</a></div>",e+='\t\t\t<div class="clear"></div>',e+="\t\t</div>",e+='\t\t<div class="message">'+window[m].htmlSpecialChar(window[m].makeEntitiesLink(this.message,this.entities))+"</div>",e+='\t\t<div class="tweetControl">',e+='\t\t\t<a class="controlIcon tweetControlReply" href="https://twitter.com/intent/tweet?in_reply_to='+this.tweetId+'" rel="nofollow" title="返信"></a>',e+='\t\t\t<a class="controlIcon tweetControlRetweet" href="https://twitter.com/intent/retweet?tweet_id='+this.tweetId+'" rel="nofollow" title="リツイート"></a>',e+='\t\t\t<a class="controlIcon tweetControlFavorite" href="https://twitter.com/intent/favorite?tweet_id='+this.tweetId+'" rel="nofollow" title="いいね"></a>',e+='\t\t\t<a class="controlIcon tweetControlReport" href="/support/report?gameId='+l+"&tweetId="+this.tweetId+'" rel="nofollow" title="管理者に報告"></a>',e+="\t\t</div>",e+='\t\t<div class="clear"></div>',e+="\t</div>",e+='\t<div class="clear"></div>',e+="</div>",e+="\n"}),e+="</div>",3<(w+=t.tweetCount)&&$("#twitterTimeLine .tweetsArea").css("height","300px"),$("#twitterTimeLine .tweets").append(e),$("#twitterTimeLine #tweets"+h).slideDown(100*t.tweetCount),h++,d=t.pageCountMax}else"NOTSIGNIN"==t.status||"NOTAUTH"==t.status?(alert(t.message),location.href="/login.html"):(""!=t.message?alert(t.message):alert("エラーが発生しました…\nしばらくしてからもう一度お試しください。"),t.data&&showLabelArea(t.data,1))})},showTweetTime:function(t,e){void 0===e&&(e=!1);var n=Date.parse(t.replace(/-/g,"/")),s=(new Date).getTime();if(s-864e5<=n){if(s-6e4<=n){var i=s-n;return i<0&&(i=0),Math.floor(i/1e3)+"秒前"}return s-36e5<=n?Math.floor((s-n)/6e4)+"分前":Math.floor((s-n)/36e5)+"時間前"}return e?t.substr(0,10):t},makeEntitiesLink:function(t,e){if(e.urls){e.urls.sort(function(t,e){var n=t.indices[0],s=e.indices[0];return s<n?1:n<s?-1:0});var s=0;for(n=0;n<e.urls.length;n++){var i=e.urls[n].url;e.urls[n].expanded_url&&(i=e.urls[n].expanded_url);var r=e.urls[n].url;e.urls[n].display_url&&(r=e.urls[n].display_url),a=o==r.substr(0,o.length)?'<a title="'+i+'" href="'+e.urls[n].url+'">'+r+"</a>":'<a title="'+i+'" href="jump?target='+encodeURIComponent(e.urls[n].url)+'">'+r+"</a>",t=t.substring(0,e.urls[n].indices[0]+s)+a+t.substring(e.urls[n].indices[1]+s),s+=a.length-(e.urls[n].indices[1]-e.urls[n].indices[0])}}if(e.hashtags){e.hashtags.sort(function(t,e){var n=t.indices[0],s=e.indices[0];return s<n?1:n<s?-1:0});s=0;for(n=0;n<e.hashtags.length;n++){var a='<a rel="nofollow" target="_blank" href="https://twitter.com/search?q='+encodeURIComponent("#"+e.hashtags[n].text)+'">#'+e.hashtags[n].text+"</a>";t=t.substring(0,e.hashtags[n].indices[0]+s)+a+t.substring(e.hashtags[n].indices[1]+s),s+=a.length-(e.hashtags[n].indices[1]-e.hashtags[n].indices[0])}}if(e.user_mentions){e.user_mentions.sort(function(t,e){var n=t.indices[0],s=e.indices[0];return s<n?1:n<s?-1:0});s=0;for(n=0;n<e.user_mentions.length;n++){a='<a rel="nofollow" target="_blank" href="https://twitter.com/'+e.user_mentions[n].screen_name+'">@'+e.user_mentions[n].screen_name+"</a>";t=t.substring(0,e.user_mentions[n].indices[0]+s)+a+t.substring(e.user_mentions[n].indices[1]+s),s+=a.length-(e.user_mentions[n].indices[1]-e.user_mentions[n].indices[0])}}return t},htmlSpecialChar:function(t){return t.replace(/(\r\n|\n|\r)/g,"<br />")}}}();function showAdFromSwf(e){if("init"==e){'<div class="adFromSwf">','<iframe src="https://s.sh.adingo.jp/if/?G=1000013361&U=1000018234&guid=ON" width="468" height="60" scrolling="no" frameborder="0" marginwidth="0" marginheight="0" style="border:none;overflow:hidden;"></iframe>','<div class="adFromSwfText">&lt;PR&gt;</div></div>',$("#flashAd").html('<div class="adFromSwf"><iframe src="https://s.sh.adingo.jp/if/?G=1000013361&U=1000018234&guid=ON" width="468" height="60" scrolling="no" frameborder="0" marginwidth="0" marginheight="0" style="border:none;overflow:hidden;"></iframe><div class="adFromSwfText">&lt;PR&gt;</div></div>')}else"show"==e?$("#flashAd").fadeIn(1500):$("#flashAd").hide()}$(function(){function e(){if(isSp()){var e,o,t,i,n,s=728,a=479,r=window.innerWidth,d=window.innerHeight,m=!1;if((r<=s||d<=a)&&(m=!0),m)(r-2)*a<(d-42)*s?(i=s*(e=(r-2)/s),n=a*e,t=(o=(s-r)/-2*e-1)*a/s):(n=a*(e=(d-42)/a),t=(a-d)/-2*e,o=(r-(i=s))/2),$("#mtjAutoArea").css("transform","scale("+e+")"),$("#mtjAutoArea").css("top",t),$("#mtjAutoArea").css("left",o),$("#mtjAutoArea").css("width",i),$("#mtjAutoArea").css("height",n);else $("#mtjAutoArea").css("transform","scale(1)"),$("#mtjAutoArea").css("top",0),$("#mtjAutoArea").css("left",0),$("#mtjAutoArea").css("width",s),$("#mtjAutoArea").css("height",a)}}if(e(),$(window).resize(function(){e()}),isSp()&&($(".isJsSpOnly").show(),!isSp(!1)&&!$.cookie("app")&&!$.cookie("app_session"))){var o=new URL(document.URL),t=new URLSearchParams(o.search.slice(1)),i=new URLSearchParams;i.append("gameId",$("#gameId").val()),t.has("pw")&&i.append("pw",t.get("pw")),t.has("blid")&&i.append("blid",t.get("blid")),t.has("bsn")&&i.append("bsn",t.get("bsn"));var s="/switch-jf?key=app&jf=a&"+i.toString();return location.href=s,!0}if(document.getElementById("commentListArea")){var a=!1;if("IntersectionObserver"in window){var r=new IntersectionObserver(function(e,o){e.forEach(function(e){e.isIntersecting&&!a&&(a=!0,window.myTypingComment.showLastCommentList(),r.unobserve(document.getElementById("commentListArea")))})},{rootMargin:"0px 0px 50px 0px"});r.observe(document.getElementById("commentListArea"))}else $(window).scroll(function(){!a&&$("#listArea").offset().top<$(window).scrollTop()&&(a=!0,window.myTypingComment.showLastCommentList())})}if(document.getElementById("twitterTimeLine")){window.myTypingTwitter.initTimeline($("base").attr("href"),$("#gameId").val(),hd($("title").html()));var d=!1;if("IntersectionObserver"in window){var m=new IntersectionObserver(function(e,o){e.forEach(function(e){e.isIntersecting&&!d&&(d=!0,window.myTypingTwitter.setTimeline(),m.unobserve(document.getElementById("twitterTimeLine")))})},{rootMargin:"0px 0px 50px 0px"});m.observe(document.getElementById("twitterTimeLine"))}else $(window).scroll(function(){!d&&$("#listArea").offset().top<$(window).scrollTop()&&(d=!0,window.myTypingTwitter.setTimeline())})}$(".mtjRunBtn").click(function(){$("#gameSpApp").hide()});var k,l;$("#bookmarkArea").append('<span id="bookmarkedArea"><span class="bookmarked"><span id="bookmarkedButton" class="textButtonGray">お気に入り登録済</span></span><span class="bookmarkedHidden"><span class="deleteBookmark textButtonGray">解除</span>&nbsp;<span class="addBookmark textButtonGray">さらに登録</span></span></span><div id="moveBookmarkPopup" class="userInputArea" style="display:none;">\t<div id="moveBookmarkPopupMessage">お気に入りに追加しました。</div>\t<div id="moveBookmarkPopupSelect">\t\t<select name="moveBookmarkListId" id="moveBookmarkListId" class="radiusFormText"></select>\t\t<input type="button" id="moveBookmarkEndButton" class="submit" value="完了" />\t</div></div>'),0==$("#isUserBookmarkedGame").val()?$("#bookmarkedArea").css("display","none"):$("#addBookmarkButton").css("display","none"),$(".bookmarkedHidden").css("display","none"),$(document).click(function(e){$("#moveBookmarkPopup").is(":visible")&&!$.contains($("#moveBookmarkPopup")[0],e.target)&&$("#moveBookmarkPopup").hide()}),$(".addBookmark").live("click",function(){if(0==$("#userId").val())location.href="/login.html?code=2";else{var e=new Date;$.getJSON("/player/add-bookmark-json?gameId="+$("#bookmarkGameId").val()+"&t="+e.getTime(),function(e){if("OK"==e.status){if(1<e.bookmarkListCount){for($("#moveBookmarkListId > option").remove(),n=0;n<e.bookmarkLists.length;n++)$("#moveBookmarkListId").append($("<option>").html(h(e.bookmarkLists[n].title)).val(e.bookmarkLists[n].bookmarkListId));$("#moveBookmarkListId").val(e.bookmarkListId),$("#moveBookmarkPopup").show();var o=$("#moveBookmarkListId").outerWidth()+$("#moveBookmarkEndButton").outerWidth()+10;o<window.innerWidth&&$("#moveBookmarkPopupSelect").width(o)}k=e.bookmarkListId,l=e.sortNo,$("#addBookmarkButton").hide(),$("#bookmarkedArea").show(),$("#bookmarkedButton").show()}else e.message?alert(e.message):alert("お気に入りの追加に失敗しました・・・")})}}),$("#moveBookmarkEndButton").live("click",function(){if($("#moveBookmarkListId").val()==k)$("#moveBookmarkPopup").hide();else{var e=new Date;$.getJSON("/player/move-bookmark-json?bookmarkListId="+k+"&toBookmarkListId="+$("#moveBookmarkListId").val()+"&sortNo="+l+"&t="+e.getTime(),function(e){"OK"==e.status?$("#moveBookmarkPopup").hide():e.message?alert(e.message):alert("お気に入りの移動に失敗しました・・・")})}}),$("#bookmarkedArea").live({mouseenter:function(){$(".bookmarkedHidden").show(),$(".bookmarked").hide()},mouseleave:function(){$(".bookmarkedHidden").hide(),$(".bookmarked").show()}}),$(".deleteBookmark").live("click",function(){var e=new Date;$.getJSON("/player/delete-bookmark-json?gameId="+$("#bookmarkGameId").val()+"&t="+e.getTime(),function(e){"OK"==e.status?($("#addBookmarkButton").show(),$("#bookmarkedArea").hide(),$(".bookmarkedHidden").hide()):e.message?alert(e.message):alert("お気に入りの削除に失敗しました・・・")})}),$("#hideMoreQuestionsButton").click(function(e){$(".startQuestion").hide(),$(".blockQuestions .moreQuestion").show(),$(".inlineQuestions .moreQuestion").css("display","inline"),$("#questionBoxTail .moreQuestion").show()}),$("#showMoreQuestionsButton").click(function(e){$(".startQuestion").show(),$(".moreQuestion").hide()}),$("#hideKanaQuestionsButton").click(function(e){$("#questionBox .kana").hide(),$("#hideKanaQuestionsButton").hide(),$("#showKanaQuestionsButton").css("display","inline-block")}),$("#showKanaQuestionsButton").click(function(e){$("#questionBox .kana").show(),$("#hideKanaQuestionsButton").css("display","inline-block"),$("#showKanaQuestionsButton").hide()})});